client_id,name,age,gender,marital_status,salary,employment_years,credit_score,has_property,loan_amount,loan_term_months,existing_loans,late_payments,return_loan
1,Alex Johnson,34,Male,Married,4200,6,710,1,8000,24,1,0,1
2,Sophia Miller,29,Female,Single,3800,4,690,0,6000,18,0,1,1
3,Michael Brown,45,Male,Married,5400,12,730,1,15000,36,2,1,1
4,Emily Davis,31,Female,Single,3500,5,660,0,7000,24,1,1,0
5,Daniel Wilson,52,Male,Married,6200,20,780,1,20000,48,2,0,1
6,Olivia Moore,27,Female,Single,3600,3,650,0,5000,12,0,2,0
7,James Taylor,39,Male,Married,4900,10,720,1,12000,36,1,0,1
8,Ava Anderson,33,Female,Single,4100,7,705,0,9000,24,0,0,1
9,Ethan Thomas,42,Male,Married,5300,15,745,1,14000,30,2,1,1
10,Isabella Jackson,26,Female,Single,3400,3,640,0,4500,12,1,2,0
11,Liam White,37,Male,Married,4700,8,700,1,11000,24,1,0,1
12,Mia Harris,30,Female,Single,3900,4,685,0,6500,18,0,1,1
13,Noah Martin,48,Male,Married,5800,18,760,1,18000,48,2,0,1
14,Charlotte Thompson,35,Female,Divorced,4200,6,710,1,9000,24,1,1,1
15,William Garcia,44,Male,Married,5500,14,735,1,16000,36,2,0,1
16,Amelia Martinez,32,Female,Single,4000,5,690,0,7500,18,0,0,1
17,Benjamin Robinson,28,Male,Single,3600,3,660,0,6000,12,1,2,0
18,Harper Clark,41,Female,Married,5200,12,740,1,13000,30,2,0,1
19,Lucas Rodriguez,50,Male,Married,6000,20,770,1,19000,48,1,0,1
20,Evelyn Lewis,34,Female,Single,4300,6,705,0,8500,24,1,1,1
21,Mason Lee,29,Male,Single,3800,4,670,0,7000,18,0,1,1
22,Abigail Walker,33,Female,Married,4100,7,700,1,9000,24,1,0,1
23,Henry Hall,46,Male,Married,5600,16,740,1,15000,36,2,1,1
24,Ella Allen,27,Female,Single,3500,3,655,0,5000,12,1,2,0
25,Jacob Young,38,Male,Married,4800,9,715,1,12000,24,1,0,1
26,Aria Hernandez,31,Female,Divorced,3900,5,680,0,6500,18,0,1,1
27,Logan King,43,Male,Married,5400,13,735,1,14000,30,1,0,1
28,Chloe Wright,30,Female,Single,3700,4,665,0,6000,18,1,1,0
29,Sebastian Lopez,47,Male,Married,5700,17,750,1,17000,48,2,0,1
30,Grace Hill,36,Female,Married,4200,6,700,1,9000,24,1,1,1
31,Jack Scott,40,Male,Married,5000,10,720,1,13000,24,1,0,1
32,Victoria Green,28,Female,Single,3600,3,650,0,5000,12,0,2,0
33,Alexander Adams,49,Male,Married,5900,19,765,1,18000,36,2,0,1
34,Nora Baker,34,Female,Single,4100,6,695,0,8500,18,1,1,1
35,Samuel Nelson,32,Male,Married,4400,5,705,0,9000,24,1,0,1
36,Hannah Carter,27,Female,Single,3500,2,645,0,4500,12,1,2,0
37,David Mitchell,45,Male,Married,5500,15,740,1,15000,36,2,0,1
38,Lily Perez,33,Female,Single,3900,6,690,0,7000,18,0,1,1
39,Matthew Roberts,41,Male,Married,5200,11,725,1,13000,30,1,0,1
40,Zoe Turner,29,Female,Single,3800,4,660,0,6000,18,1,1,0
41,Joseph Phillips,50,Male,Married,6100,20,770,1,19000,48,2,0,1
42,Sofia Campbell,31,Female,Divorced,4000,5,680,0,7500,18,1,1,1
43,Andrew Parker,35,Male,Married,4600,7,710,1,10000,24,1,0,1
44,Layla Evans,28,Female,Single,3600,3,650,0,5500,12,1,2,0
45,Christopher Edwards,44,Male,Married,5600,14,740,1,16000,36,2,0,1
46,Penelope Collins,32,Female,Single,3900,5,685,0,7000,18,0,1,1
47,Nathan Stewart,48,Male,Married,5800,18,760,1,17000,36,1,0,1
48,Riley Sanchez,33,Female,Single,4100,6,700,0,8500,24,1,1,1
49,Christian Morris,37,Male,Married,4900,8,720,1,12000,24,1,0,1
50,Aurora Rogers,26,Female,Single,3400,2,640,0,4500,12,1,2,0
51,Jonathan Reed,39,Male,Married,5100,10,725,1,13000,24,1,0,1
52,Stella Cook,34,Female,Single,4200,6,700,0,8500,18,1,1,1
53,Thomas Morgan,45,Male,Married,5500,15,740,1,15000,36,2,0,1
54,Victoria Bell,31,Female,Single,3900,4,680,0,6500,18,1,1,1
55,Robert Murphy,46,Male,Married,5700,16,750,1,16000,36,2,0,1
56,Luna Bailey,29,Female,Single,3700,4,660,0,6000,12,1,2,0
57,Adam Rivera,41,Male,Married,5300,12,730,1,14000,24,1,0,1
58,Claire Cooper,27,Female,Single,3500,2,645,0,5000,12,0,2,0
59,Julian Richardson,44,Male,Married,5600,14,740,1,15000,36,2,0,1
60,Natalie Cox,36,Female,Single,4200,6,700,0,9000,24,1,1,1
61,Isaac Howard,40,Male,Married,5000,11,720,1,13000,24,1,0,1
62,Elena Ward,33,Female,Single,3900,5,680,0,7000,18,1,1,1
63,Aaron Torres,47,Male,Married,5800,17,760,1,17000,36,2,0,1
64,Savannah Peterson,28,Female,Single,3600,3,650,0,5500,12,1,2,0
65,Connor Gray,42,Male,Married,5200,12,725,1,14000,24,1,0,1
66,Lydia Ramirez,34,Female,Divorced,4100,6,695,0,8500,18,1,1,1
67,Eli James,31,Male,Single,4000,4,690,0,7500,18,0,1,1
68,Anna Watson,27,Female,Single,3500,2,645,0,4500,12,1,2,0
69,Wyatt Brooks,49,Male,Married,6000,19,765,1,18000,36,1,0,1
70,Lucy Kelly,35,Female,Married,4200,6,705,1,9000,24,1,1,1
71,Charles Sanders,38,Male,Married,4900,9,715,1,12000,24,1,0,1
72,Madison Price,30,Female,Single,3700,4,665,0,6500,18,1,1,1
73,Gabriel Bennett,46,Male,Married,5600,15,740,1,16000,36,2,0,1
74,Naomi Wood,32,Female,Single,3900,5,685,0,7000,18,0,1,1
75,Anthony Barnes,43,Male,Married,5300,13,735,1,14000,30,1,0,1
76,Sarah Ross,28,Female,Single,3600,3,650,0,5500,12,1,2,0
77,Kevin Henderson,48,Male,Married,5800,18,760,1,17000,36,2,0,1
78,Eva Coleman,33,Female,Single,4100,6,700,0,8500,24,1,1,1
79,Brandon Jenkins,37,Male,Married,4900,8,720,1,12000,24,1,0,1
80,Nora Perry,29,Female,Single,3800,4,670,0,6000,18,0,1,1
81,Jason Powell,44,Male,Married,5600,14,740,1,15000,36,2,0,1
82,Ellie Long,31,Female,Single,3900,5,680,0,6500,18,1,1,1
83,Jordan Patterson,50,Male,Married,6100,20,770,1,19000,48,2,0,1
84,Alice Hughes,34,Female,Single,4200,6,700,0,8500,24,1,1,1
85,Owen Flores,40,Male,Married,5000,10,720,1,13000,24,1,0,1
86,Piper Washington,27,Female,Single,3500,3,650,0,4500,12,1,2,0
87,Eric Butler,47,Male,Married,5800,16,755,1,17000,36,1,0,1
88,Camila Simmons,32,Female,Single,4000,5,685,0,7000,18,0,1,1
89,Tyler Foster,42,Male,Married,5200,11,725,1,14000,24,1,0,1
90,Aaliyah Bryant,30,Female,Single,3700,4,665,0,6000,18,1,1,1
91,Justin Alexander,45,Male,Married,5500,15,740,1,16000,36,2,0,1
92,Brooklyn Russell,36,Female,Single,4200,6,705,0,9000,24,1,1,1
93,Luke Griffin,38,Male,Married,4800,8,710,1,12000,24,1,0,1
94,Autumn Diaz,28,Female,Single,3600,3,650,0,5500,12,1,2,0
95,Asher Hayes,49,Male,Married,6000,19,765,1,18000,36,2,0,1
96,Arianna Myers,34,Female,Single,4100,6,695,0,8500,24,1,1,1
97,Jonathan Ford,41,Male,Married,5300,12,730,1,14000,30,1,0,1
98,Hailey Hamilton,27,Female,Single,3500,3,645,0,4500,12,1,2,0
99,Declan Graham,43,Male,Married,5400,13,735,1,14000,30,2,0,1
100,Leah Sullivan,32,Female,Single,4000,5,685,0,7000,18,0,1,1


# credit_rf.py

import pandas as pd
from sklearn.preprocessing import LabelEncoder, StandardScaler
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score

# -----------------------
# 1. Загрузка данных
# -----------------------
df = pd.read_csv("clients.csv")

# -----------------------
# 2. Подготовка данных
# -----------------------
df2 = df.copy()
df2 = df2.drop(columns=["client_id", "name"])

categorical_cols = ["gender", "marital_status"]
encoders = {}
for col in categorical_cols:
    le = LabelEncoder()
    df2[col] = le.fit_transform(df2[col])
    encoders[col] = le

# -----------------------
# 3. Разделение на X и y
# -----------------------
X = df2.drop(columns=["return_loan"])
y = df2["return_loan"]

# -----------------------
# 4. Масштабирование (опционально для RF)
# -----------------------
scaler = StandardScaler()
X_scaled = scaler.fit_transform(X)

# -----------------------
# 5. Разделение на обучение и тест
# -----------------------
X_train, X_test, y_train, y_test = train_test_split(
    X_scaled, y, test_size=0.2, random_state=42
)

# -----------------------
# 6. Обучение Random Forest
# -----------------------
rf = RandomForestClassifier(n_estimators=200, max_depth=6, random_state=42)
rf.fit(X_train, y_train)

# -----------------------
# 7. Оценка точности
# -----------------------
pred_test = rf.predict(X_test)
acc = accuracy_score(y_test, pred_test)
print("Точность модели на тесте:", round(acc, 3))

# -----------------------
# 8. Функция предсказания нового клиента
# -----------------------
def predict_client(data: dict):
    new_df = pd.DataFrame([data])

    # Категориальные → числа
    for col in categorical_cols:
        le = encoders[col]
        new_df[col] = le.transform(new_df[col])

    # Масштабирование
    new_scaled = scaler.transform(new_df)

    # Прогноз и вероятность
    prob = rf.predict_proba(new_scaled)[0][1]  # вероятность возврата
    pred = rf.predict(new_scaled)[0]

    return int(pred), float(prob)

# -----------------------
# 9. Пример использования
# -----------------------
client_example = {
    "age": 74,
    "gender": "Male",
    "marital_status": "Single",
    "salary": 500,
    "employment_years": 5,
    "credit_score": 500,
    "has_property": 1,
    "loan_amount": 1000000,
    "loan_term_months": 24,
    "existing_loans": 1,
    "late_payments": 0
}

pred, prob = predict_client(client_example)
print("Вернет кредит:", pred)
print("Шанс возврата:", round(prob, 3) * 100, '%')
